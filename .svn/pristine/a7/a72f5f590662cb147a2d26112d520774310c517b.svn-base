{include file="./admin-layout/header.html" /}
<div class="admin-main">
    <div class="layui-form">
        <form method="get" action="{:url('edite')}">
            <blockquote class="layui-elem-quote" style="font-size: 12px;">
                <div class="layui-form-item" style="margin-bottom: 0px;">
                    <table class="layui-table">
                        <thead>
                            <tr>
                                <th>设备编号</th>
                                <th>设备名称</th>
                                <th>设备地区</th>
                                <th>所属医院</th>
                                <th>柜门数量</th>
                                <th>负责人</th>
                                <th>负责人电话</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody style="background-color: #f1f1f1;">
                            {volist name='list' id='v'}
                            <tr>
                                <input type="hidden" value="{$v.id}">
                                <td>{$v.equipment_no}</td>
                                <td style="width: 200px;background: white;"><input type="text" name="equipment_name" style="width: 200px; height: 24px;border: snow;" value="{$v.equipment_name}"></td>
                                <td style="width: 250px;background-color: white;">
                                    <input type="text" style="display: none" placeholder="请选择省市区" style="width: 250px;height: 24px;border: snow;">
                                    <select name="region" id="region" onchange="region()">
                                        {foreach name="region" item="vo"}
                                        <option value="{$vo.id}">{$vo.name}</option>
                                        {/foreach}
                                    </select>
                                </td>
                                <td style="width: 200px;background: white;">
                                    <select name="hospital" id="" style="width: 24px">
                                        <option value="">请选择所属医院</option>
                                        {foreach name="hospital" item="vo"}
                                        <option value="{$vo.id}">{$vo.hospital_name}</option>
                                        {/foreach}
                                    </select>
                                </td>
                                <td>{$v.model_num}</td>
                                <td style="width: 200px;background: white;"><input type="text" name="charge_name" value="{$v.charge_name}" style="width: 200px; height: 24px;border: snow;"></td>
                                <td style="width: 200px;background: white;"><input type="text" name="charge_phone" value="{$v.charge_phone}" style="width: 200px; height: 24px;border: snow;"></td>
                                <td>
                                    {if condition="$v.status eq 1"}
                                    正常
                                    {/if}{if condition="$v.status eq 2"}
                                    不正常
                                    {/if}
                                </td>
                            </tr>
                            {/volist}
                        </tbody>
                    </table>
                </div>
            </blockquote>
            <blockquote class="layui-elem-quote" style="font-size: 12px;">
                <label class="layui-form-label" style="width: auto">免费时长：</label>
                <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" onclick="jian()" id="num1">-</button>
                <div class="layui-input-inline" style="width:auto;">
                    <input type="text" class="layui-input" style="width:80px" name="free_time" id="num" value="0" placeholder="选择时长" autocomplete="off">
                </div>
                <button type="button" class="layui-btn layui-btn-primary layui-btn-sm" onclick="jia()" id="num2">+</button>
                <span style="margin-right: 120px;">分钟</span>
                <div class="layui-input-inline" style="width:auto;margin-right: 90px;">
                    <label class="layui-form-label" style="width: auto">计费金额：</label>
                    <input type="text" style="width: 80px;display: inline;" class="layui-input" style="width:200px" name="money" id="name" value="" placeholder="金额" autocomplete="off">  
                    元 / 
                    <input type="text" style="width: 80px;display: inline;" class="layui-input" style="width:200px" name="filter" id="name" value="" placeholder="时间" autocomplete="off">
                </div>
            </blockquote>
            <blockquote class="layui-elem-quote" style="font-size: 12px;">
                <table class="layui-table">
                    <thead>
                        <tr style="height: 57px;">
                            <th>柜门编号</th>
                            <th>柜门名称</th>
                            <th>柜门状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody style="background-color: #f2f2f2;">
                        {foreach name="lock" item="val"}
                        <tr style="background-color: #f2f2f2;">
                            <td>{$val.lock_id}</td>
                            <td style="width: 400px;background-color: white;"><input type="text" style="width: 400px;border: snow;height: 38px;" value="{$val.lock_name}" placeholder="请输入设备名称"></td>
                            <td>
                                {switch name="$val.status" }
                                    {case value="1" }<span>借出</span>{/case}
                                    {case value="2"}<span>未借出</span>{/case}
                                    {case value="3"}<span style="color: red">损坏</span>{/case}
                                    {case value="4"}<span style="color: red">闲置</span>{/case}
                                    {default /}/
                                {/switch}</td>
                            <td>
                                <button type="button" class="layui-btn layui-btn-xs layui-btn-normal" onclick="editlock('{$val.id}','{$val.lock_id}','{$val.lock_name}','{$val.status}')">编辑</button>
                                <button type="button" class="layui-btn layui-btn-xs layui-btn-normal" onclick="opendoor('{$val.id}','{$val.lock_id}','{$val.lock_name}','{$val.status}')">开门</button>
                            </td>
                        </tr>
                        {/foreach}
                    </tbody>
                </table>
            </blockquote>
            <center>
                    <button type="submit" style="width: 150px;" class="layui-btn layui-btn-normal">保存</button>
                    <button type="button" style="width: 150px;" class="layui-btn layui-btn-primary">取消</button>
            </center>
                    
        </form>
        <div class="layui-form-item" id="lock" style="display: none;margin-top: 25px;margin-bottom: 207px;">
            <input type="hidden" name="id">
            <input type="hidden" name="lock_id">
            <div class="layui-input-inline" style="width:auto;">
                <label class="layui-form-label" style="width: auto;margin-left: 25px;">柜门名称</label>
                <input type="text" style="width: 254px;margin-left: 13px;" class="layui-input" name="lock_name" id="name" value="" placeholder="请输入柜门名称" autocomplete="off">
            </div>
            <div class="layui-input-inline" style="width:auto;margin-top: 20px;">
                <label class="layui-form-label" style="width: auto;margin-left: -4px;">选择柜门状态</label>
                <div class="layui-input-block" style="width: 121px;">
                    <select name="status" lay-verify="">
                        <option value="1">未借出</option>
                        <option value="2">已借出</option>
                        <option value="3">维修中</option>
                        <option value="4">闲置</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    //Demo
    layui.use('form', function(){
        var form = layui.form;
        
        //监听提交
        form.on('submit(formDemo)', function(data){
        layer.msg(JSON.stringify(data.field));
        return false;
        });
    });
    function FN(btnType) {
        if (btnType == 'plus') {
            $('#valShow').html(parseInt($('#valShow').html()) + 1)
        } else if (btnType == 'minus') {
            $('#valShow').html(parseInt($('#valShow').html()) - 1)
        }
    }
    function editlock(id,lock_id,lock_name,status) {
        $("input[name='id']").attr('disabled',true).val();
        $("input[name='lock_id']").val(lock_id);
        $("input[name='lock_name']").val(lock_name);
        $("input[name='status']").val(status);
        layer.open({
        type: 1
        ,title: '编辑'
        ,area: ['400px', '500px']
        ,shade: 0
        ,content: $('#lock')
        ,btn: ['确定', '取消']
        ,shade :0.8
        ,btnAlign: 'c'
        ,skin: 'open_class'
        ,yes: function(layero, index){
            var lock_name = $("input[name='lock_name']").val();
            var status = $("textarea[name='status']").val();
            if(!lock_name){
                layer.msg('请输入柜门名称');
                return false;
            }
            if(!status){
                layer.msg("请选择柜门状态");
                return false;
            }
            var field = {};
            field.lock_name = lock_name;
            field.status = status;
            $.ajax({
                url: "{:url('addhospital')}",
                data: field,
                type: "POST"
            }).done(function(data) {
                if(data.result == 0){
                    layer.msg(data.message, {
                        icon: 1,
                        time: 3000
                    },function(){
                        location.href = data.url;
                    });
                }else{
                    layer.msg(data.message, {
                        icon: 2,
                        time: 3000
                    });
                }
            }).error(function(data) {
                layer.msg('错误', {
                    icon: 2,
                    content: '服务器错误'
                })
            })
        }
      });
    }
    //数字减
    function jian(){
        var num = $("#num").val();
        var num1 = parseInt(num) - 1;
        $("#num").val(num1);
    }
    //数字加
    function jia(){
        var num = $("#num").val();
        var num1 = parseInt(num) + 1;
        $("#num").val(num1);
    }
    //地区三级联动
    // $('#region').change (function (){
    //     console.log(123);
    // })
    function region(){
        console.log(123);
        // var region_id = $("#region").val();
        // var region_name = $("#region").text();
        // console.log(region_id);
        // console.log(region_name);
        // $.ajax({
        //     url: "{:url('region')}",
        //     type:post,
        //     success:function(data){
        //         console.log(data);
        //     }
        // })
    }
</script>