{include file="./admin-layout/header.html" /}
<style>
	.layui-form-label {
		width: 120px;
	}
	
	.bigImg {
		display: none;
		justify-content: center;
		align-items: center;
		width: 100%;
		height: 100%;
		background-color: rgba(0, 0, 0, 0.3);
		left: 0;
		top: 0;
		z-index: 1000;
		position: fixed;
	}
</style>


<div class="admin-main">
    <div class="layui-form">
        <blockquote class="layui-elem-quote">
            <div class="layui-form-item" style="margin-bottom: 0px;">
                {foreach name="menulist" item="val"} {if condition="$val.id eq 135"}
				<div class="layui-input-inline" style="width: auto;">
					<button class="layui-btn layui-btn-normal" onclick="addhospital({$level},{$pid})"><i class="layui-icon">&#xe608;</i>{$val.title}</button>
					{if condition="$level gt 1"}
					<button class="layui-btn layui-btn-primary" onclick="javascript:history.go(-1)">返回</button> {/if}
				</div>
				{/if} {/foreach}
			</div>
        </blockquote>
        <table class="layui-table">
            <thead>
                <th>医院名称</th>
                <th>设备数量</th>
                <th>备注</th>
                <th>操作</th>
            </thead>
            <tbody>
                {volist name="list" id='data'}
                <tr>
                    <td>{$data.hospital_name}</td>
                    <td>{$data.count}</td>
                    <td>{$data.desc}</td>
                    <td>
                        {foreach name="menulist" item="val"}{if condition="$val.id eq 136"}
                        <button class="layui-btn layui-btn-xs layui-btn-normal" onclick="edithospital('{$data.id}','{$data.hospital_name}','{$data.desc}')">{$val.title}</button>
                        {/if} {if condition = "$val.id eq 137"}
                        <button type="button" class="layui-btn layui-btn-xs layui-btn-danger" onclick='Delete({$data.id})'>{$val.title}</button> {/if} 
                        {/foreach}
                    </td>
                </tr>
                {/volist}
            </tbody>
        </table>
        <div id="hospital" style="display: none">
            <input type="hidden" name="id" value="">
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 102px">医院名称</label>
                <div class="layui-input-inline" style="width: 390px;height: 25px;margin-left: 50px;">
                    <input type="text" name="hospital_name" required  lay-verify="required" placeholder="输入设备名称" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width: 76px">备注</label>
                <div class="layui-input-block" style="margin-left: 50px;">
                    <textarea name="desc" placeholder="请输入内容" class="layui-textarea" style="    height: 216px; width: 390px;"></textarea>
                </div>
            </div>
        </div>
        <div class="am-cf">
            <div class="am-fr over-h" id="rng">
                {empty name="list"} {else /} {$list|raw} {/empty}
            </div>
        </div>
    </div>
</div>
<script>
    layui.use('form', function(){
        var form = layui.form;
        form.on('submit(formDemo)', function(data){
        layer.msg(JSON.stringify(data.field));
        return false;
        });
    });
    //增加
    function addhospital(){
        layer.open({
        type: 1
        ,title: '新增/编辑'
        ,area: ['450px', '500px']
        ,shade: 0
        ,content: $('#hospital')
        ,btn: ['确定', '取消']
        ,shade :0.8
        ,btnAlign: 'c'
        ,skin: 'open_class'
        ,yes: function(layero, index){
            var hospital_name = $("input[name='hospital_name']").val();
            var desc = $("textarea[name='desc']").val();
            if(!hospital_name){
                layer.msg('请输入医院名称');
                return false;
            }
            if(!desc){
                layer.msg("请输入备注")
            }
            var field = {};
            field.hospital_name = hospital_name;
            field.desc = desc;if(data.)
            $.ajax({
                url: "{:url('addhospital')}",
                data: field,
                type: "POST"
            }).done(function(data) {
                if(data.result == 0){
                    layer.msg(data.message, {
                        icon: 1,
                        time: 3000
                    },function(){
                        location.href = data.url;
                    });
                }else{
                    layer.msg(data.message, {
                        icon: 2,
                        time: 3000
                    });
                }
            }).error(function(data) {
                layer.msg('错误', {
                    icon: 2,
                    content: '服务器错误'
                })
            })
        }
      });
    }
    //删除
    function Delete(id){
        layer.confirm('您确定要删除吗？', {
                icon: 3, 
                title:'温馨提示'
            }, function(index){
                $.ajax({
                    url: "{:url('deletehospital')}",
                    data: {id:id},
                    type: "GET",
                    dataType: "json"
                }).done(function(data) {
                    if(data.result == 0) {
                        layer.msg(data.message, {
                            icon: 1,
                            time: 3000
                        }, function() {
                            location.href = data.url;
                        });
                    } else {
                        layer.msg(data.message, {
                            icon: 2,
                            time: 3000
                        });
                    }
                }).error(function(data){
                    layer.msg('错误', {
                        icon: 2,
                        content: '服务器错误'
                    });
                });
                layer.close(index);
        });
    }
    //编辑
    function edithospital(id,name,desc){
        $("input[name='id']").attr('disabled',true).val(id);
        $("input[name='hospital_name']").val(name);
        $("textarea[name='desc']").val(desc);
        layer.open({
        type: 1
        ,title: '新增/编辑'
        ,area: ['450px', '500px']
        ,shade: 0
        ,content: $('#hospital')
        ,btn: ['确定', '取消']
        ,shade :0.8
        ,btnAlign: 'c'
        ,skin: 'open_class'
        ,yes: function(layero, index){
            var id = $("input[name='id']").val();
            var hospital_name = $("input[name='hospital_name']").val();
            var desc = $("textarea[name='desc']").val();
            if(!hospital_name){
                layer.msg('请输入医院名称');
                return false;
            }
            if(!desc){
                layer.msg("请输入备注")
            }
            var field = {};
            field.id = id
            field.hospital_name = hospital_name;
            field.desc = desc;
            $.ajax({
                url: "{:url('edithospital')}",
                data: field,
                type: "POST"
            }).done(function(data) {
                if(data.result == 0){
                    layer.msg(data.message, {
                        icon: 1,
                        time: 3000
                    },function(){
                        location.href = data.url;
                    });
                }else{
                    layer.msg(data.message, {
                        icon: 2,
                        time: 3000
                    });
                }
            }).error(function(data) {
                layer.msg('错误', {
                    icon: 2,
                    content: '服务器错误'
                })
            })
        }
      });
    }
</script>